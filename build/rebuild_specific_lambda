#/bin/sh

# Source code for automatically rebuilding/deploying lambda functions after successful push to master
# This code should exist in .git/hooks/post-update

echo "Redeploying specific lambadas"

read -p "Enter lambda function names separated by whitespace : " input

# Rebuild our code with Maven and check that build succeeded
build_status=$(mvn package -f ../youTrek/ | grep BUILD | cut -d " " -f3)
if [[ $build_status =~ "SUCCESS" ]]
then
	echo "Maven build success!"
else
	echo "Maven build failed, exiting pre-deployment"
	exit 0
fi

target_jar='../youTrek/target/YouTrek-1.0.jar'

# for each lambda function, redeploy to aws
for lambda in "${input[@]}"; do
	aws lambda update-function-code \
		--function-name $lambda \
		--zip-file fileb://../youTrek/target/youTrek-1.0.jar
done

echo "Done with redeployment. See AWS CLI error/success messages above."

